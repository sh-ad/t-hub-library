<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–í–∑—è—Ç—å –∫–Ω–∏–≥—É ‚Äî T-Hub Library</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#0b0c10;--fg:#e6e6e6;--muted:#a6a6a6;
      --card:#13151a;--accent:#3b82f6;--accent-contrast:#fff;
      --border:#23252b;--ok:#22c55e;--err:#e11d48;
    }
    @media (prefers-color-scheme: light){
      :root{--bg:#f8fafc;--fg:#0f172a;--muted:#475569;--card:#fff;--border:#e2e8f0;--accent:#2563eb;}
    }
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);color:var(--fg);
      display:flex;align-items:center;justify-content:center;min-height:100vh;padding:24px;
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;
      padding:28px;max-width:600px;width:100%;text-align:center;
      box-shadow:0 10px 25px rgba(0,0,0,.15);}
    h1{margin:0 0 12px;font-size:24px}
    p{margin:6px 0;color:var(--muted)}
    .code{font-size:42px;font-weight:700;letter-spacing:.04em;
      padding:16px;border-radius:12px;background:rgba(148,163,184,.1);
      border:1px dashed var(--border);margin:16px 0;word-break:break-all;}
    input[type=text]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--border);
      background:transparent;color:var(--fg);font-size:18px;text-align:center;margin-bottom:12px;}
    button{padding:12px 18px;border:0;border-radius:10px;font-size:16px;cursor:pointer;}
    .primary{background:var(--accent);color:var(--accent-contrast);}
    .ghost{background:transparent;border:1px solid var(--border);color:var(--fg);margin-left:8px;}
    .hint{font-size:14px;color:var(--muted);margin-top:10px;}
    .ok{color:var(--ok)} .err{color:var(--err)}
    a{color:var(--accent);text-decoration:none}
  </style>
</head>
<body>
  <main class="card">
    <h1>üìö –í–∑—è—Ç—å –∫–Ω–∏–≥—É</h1>
    <p>–ö–æ–¥ –∫–Ω–∏–≥–∏ –∏–∑ QR-—Å—Å—ã–ª–∫–∏ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:</p>
    <div id="codeView" class="code">‚Äî</div>
    <input type="text" id="codeInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, A1B2)" />
    <div>
      <button id="copyOpen" class="primary">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å –≤ Time</button>
      <button id="copyOnly" class="ghost">–¢–æ–ª—å–∫–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>
    <p id="status" class="hint"></p>
    <p class="hint">–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–∫—Ä—ã–ª–æ—Å—å ‚Äî –æ—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç –≤—Ä—É—á–Ω—É—é:<br>
      <a href="https://time.tbank.ru/tinkoff/messages/@t-hub-library" target="_blank">
        @t-hub-library –≤ Time</a>
    </p>
  </main>

  <script>
    const TIME_DEEPLINK = "timeapp://time.tbank.ru/tinkoff/messages/@t-hub-library";

    const q = new URLSearchParams(location.search);
    const rawPayload = q.get('payload');
    let code = q.get('code') || q.get('c') || q.get('k') || location.hash.replace(/^#/, '');

    if (rawPayload && !code) {
      try {
        const json = JSON.parse(atob(rawPayload.replace(/-/g,'+').replace(/_/g,'/')));
        code = json.code || json.book_id || json.id;
      } catch(e){}
    }

    const normalize = s => (s||'').trim().replace(/\s+/g,'').toUpperCase();
    code = normalize(code);

    const input = document.getElementById('codeInput');
    const view = document.getElementById('codeView');
    const status = document.getElementById('status');
    input.value = code;
    if (code) view.textContent = code;

    input.addEventListener('input', ()=>view.textContent = normalize(input.value)||'‚Äî');

    async function copyToClipboard(text){
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch(e){
        const t = document.createElement('textarea');
        t.value=text;document.body.appendChild(t);t.select();
        const ok=document.execCommand('copy');document.body.removeChild(t);
        return ok;
      }
    }

    document.getElementById('copyOnly').onclick = async ()=>{
      const val = normalize(input.value);
      if(!val){status.innerHTML='<span class="err">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–Ω–∏–≥–∏</span>';return;}
      const ok = await copyToClipboard(val);
      status.innerHTML = ok ? '<span class="ok">–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω ‚Äî –æ—Ç–∫—Ä–æ–π—Ç–µ Time –∏ –≤—Å—Ç–∞–≤—å—Ç–µ (Ctrl+V)</span>'
                            : '<span class="err">–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</span>';
    };

    document.getElementById('copyOpen').onclick = async ()=>{
      const val = normalize(input.value);
      if(!val){status.innerHTML='<span class="err">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–Ω–∏–≥–∏</span>';return;}
      const ok = await copyToClipboard(val);
      status.innerHTML = ok ? '<span class="ok">–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä</span>'
                            : '<span class="err">–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</span>';
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Time
      setTimeout(()=>{ window.location.href = TIME_DEEPLINK; }, 200);
    };
  </script>
</body>
</html>
